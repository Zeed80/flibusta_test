---
name: Code Quality Standards
description: Стандарты качества кода для проекта Flibusta
globs: ["**/*.php", "**/*.js", "**/*.css", "**/*.sql"]
alwaysApply: true
---

# Стандарты качества кода

## PHP (8.1+)

### Стиль кода
- Соблюдение PSR-12 (PHP Coding Standard)
- Типизация параметров и возвращаемых значений
- Strict mode: `declare(strict_types=1);` в начале каждого файла
- Null-безопасность: использовать null-coalescing операторы, null-safe операторы
- Максимальная длина строки: 120 символов

### Безопасность
- **Использовать параметризованные запросы** (prepared statements) - обязательно!
- Экранировать вывод (htmlspecialchars, json_encode с флагами)
- Проверять и валидировать все входные данные
- Использовать CSP (Content Security Policy) для защиты от XSS
- Хешировать пароли (password_hash, password_verify)

### Логирование
- Логировать все исключения с детализацией (error_log, logger)
- Не логировать конфиденциальные данные (пароли, токены)
- Использовать разные уровни логирования (DEBUG, INFO, WARNING, ERROR)

### Обработка ошибок
- Использовать try-catch для всех критических операций
- Предоставлять информативные сообщения об ошибках (для пользователя)
- Не раскрывать внутренние детали системы в ошибках для пользователя
- Логировать стек вызовов для отладки

### Тестирование
- Писать unit-тесты для бизнес-логики (PHPUnit)
- Писать integration тесты для API endpoints
- Минимальный coverage: 80%

## PostgreSQL (14+)

### Запросы
- Использовать параметризованные запросы (PDO::prepare)
- Оптимизировать запросы с индексами (EXPLAIN ANALYZE)
- Использовать транзакции для связанных операций
- Ограничивать количество возвращаемых строк (LIMIT, pagination)

### Безопасность
- **Никогда не использовать прямую интерполяцию строк в SQL**
- Использовать prepared statements
- Минимальные права пользователя базы данных
- Ротация паролей

## JavaScript (ES2023)

### Стиль кода
- Использовать const/let, избегать var
- Arrow functions для callbacks
- Async/await вместо Promises callbacks
- Модули (import/export)

### Производительность
- Lazy loading для изображений и компонентов
- Event delegation вместо множества listeners
- Debounce/throttle для часто вызываемых функций
- Минимизация DOM операций

## HTML5

### Семантика
- Использовать семантические теги (header, nav, main, article, footer)
- Правильная иерархия заголовков (h1-h6)
- Атрибуты ARIA для доступности

### Доступность (WCAG 2.1 AA)
- Alt текст для всех изображений
- Правильные labels для form элементов
- Адекватный контраст цветов
- Поддержка keyboard navigation

## CSS3

### Организация
- BEM методология для классов (.block__element--modifier)
- Медиа-запросы для responsive design
- CSS Grid и Flexbox для layout

### Производительность
- Использовать transform и opacity для анимаций (GPU ускорение)
- Избегать !important
- ОптимизироватьCritical Rendering Path

## Общие правила

- Документация на русском языке
- Описательные имена переменных и функций
- DRY (Don't Repeat Yourself)
- SOLID принципы
- Max function length: 50 lines
- Max cyclomatic complexity: 10
