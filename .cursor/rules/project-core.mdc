---
name: Project Core Rules
description: Основные принципы и правила для проекта Flibusta
globs: ["**/*"]
alwaysApply: true
---

# Основные принципы проекта Flibusta

## Обязательные правила

1. **Всегда используй MCP Context7** для получения актуальной документации перед написанием кода
2. **Применяй веб-поиск** для проверки фактов перед генерацией кода
3. **Никогда не галлюцинируй** - проверяй все API, функции, синтаксис
4. **Пиши полный код без упрощений** - никаких заглушек и TODO
5. **При изменениях всегда проверяй все зависимые файлы** и вноси исправления
6. **Используй последние версии зависимостей и библиотек**
7. **Всегда пиши на русском языке** (комментарии, документация)
8. **Проект развернут на отдельном Linux сервере (Debian, Ubuntu, CentOS)** - не запускай Docker или команды локально
9. **Никогда не выполняй команды без разрешения пользователя** - если нужно что-то важное, всегда спрашивай
10. **Полуавтоматический режим**: AI предлагает → Пользователь утверждает → AI реализует

## Технический стек

- **Backend**: PHP 8.1+, PostgreSQL 14+
- **Frontend**: HTML5, CSS3, JavaScript (ES2023), Bootstrap 5
- **Deployment**: Docker, Docker Compose, Nginx
- **OPDS**: версии 1.0 и 1.2

## Рабочий процесс

1. Понять запрос пользователя
2. Использовать `codebase_search` для анализа существующего кода
3. Проверить через MCP Context7 актуальность синтаксиса/API
4. Использовать веб-поиск для best practices
5. Проверить все зависимости проекта
6. Предложить решение пользователю (НЕ реализовывать без утверждения)
7. После утверждения - реализовать полный код
8. Протестировать изменения

## Запрещено

- Не запускать Docker или любые команды на локальной машине (Windows/PowerShell)
- Не генерировать PowerShell команды для Linux-сервера
- Не выполнять команды на сервере без разрешения пользователя
- Не предлагать критические команды без предупреждения о рисках
- Не писать заглушки (TODO, FIXME, stub functions)
- Не галлюцинировать несуществующие функции/API
- Не реализовывать без утверждения пользователя
- Не проверять код только через знания - всегда используй MCP Context7 и веб-поиск
- Не писать код на английском (кроме технических терминов)

## Обязательно

- Всегда спрашивать разрешения пользователя перед выполнением любых команд (особенно DevOps/Server)
- Пользователь на Windows (PowerShell), проект на Linux-сервере - предлагать команды для SSH/Bash, НЕ PowerShell!
- Всегда обновлять все зависимые файлы при изменениях
- Всегда писать валидацию входных данных
- Всегда обрабатывать исключения с логированием
- Всегда писать комментарии на русском языке
- Всегда проверять SQL запросы на инъекции
- Всегда использовать параметризованные запросы (prepared statements)
